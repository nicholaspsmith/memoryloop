#!/bin/bash

# Pre-push hook to prevent direct pushes to main branch
# Override with: FORCE_PUSH_MAIN=1 git push

protected_branch="main"

while read local_ref local_sha remote_ref remote_sha
do
  if [[ "$remote_ref" == *"$protected_branch"* ]]; then
    if [[ "$FORCE_PUSH_MAIN" != "1" ]]; then
      echo ""
      echo "üö´ Direct push to '$protected_branch' is blocked."
      echo ""
      echo "Please create a pull request instead:"
      echo "  git checkout -b feature/my-branch"
      echo "  git push -u origin feature/my-branch"
      echo "  gh pr create"
      echo ""
      echo "To bypass (admin only):"
      echo "  FORCE_PUSH_MAIN=1 git push"
      echo ""
      exit 1
    else
      echo "‚ö†Ô∏è  Bypassing branch protection (FORCE_PUSH_MAIN=1)"
    fi
  fi
done

exit 0
